var sampleData = [{ "destination": "me", "xmramount": 315.57, "time": "2016-04-21 20:39:04", "txid": "065b87fd5abe0128d790779d20a8e538cd0ca4299c85724b407f1ff5629d94ba", "_id": "065b87fd5abe0128d790779d20a8e538cd0ca4299c85724b407f1ff5629d94ba" },
    { "destination": "me", "xmramount": 7.6899999999999995, "time": "2016-04-21 20:39:04", "txid": "09bdfbc57fff2081aaa26e3a26b9ba68603017c8e39284867baecf0e3210865a", "_id": "09bdfbc57fff2081aaa26e3a26b9ba68603017c8e39284867baecf0e3210865a" },
    { "destination": "me", "xmramount": 300, "time": "2016-04-21 20:39:04", "txid": "0d30cd273d05ad23419af3d84a38db81151a056292692e82e27b14581627ad7a", "_id": "0d30cd273d05ad23419af3d84a38db81151a056292692e82e27b14581627ad7a" },
    { "destination": "me", "xmramount": 1.38, "time": "2016-04-21 20:39:04", "txid": "1008c0d6eb6f5552e17b9984cf4dcba44b23d0f33c16ebefa29e31a981cf94f0", "_id": "1008c0d6eb6f5552e17b9984cf4dcba44b23d0f33c16ebefa29e31a981cf94f0" },
    { "destination": "me", "xmramount": 200, "time": "2016-04-21 20:39:04", "txid": "12d31f59e5a062f8138100b5b3916b9ac5ca3292b47a7208284afe1eff6ee70f", "_id": "12d31f59e5a062f8138100b5b3916b9ac5ca3292b47a7208284afe1eff6ee70f" },
    { "destination": "me", "xmramount": 62.4, "time": "2016-04-21 20:39:04", "txid": "12d4188aedd05b42272f2c593314ce7480586080e56d9b54bd8d7ccc1d61e6ca", "_id": "12d4188aedd05b42272f2c593314ce7480586080e56d9b54bd8d7ccc1d61e6ca" },
    { "destination": "me", "xmramount": 0.09, "time": "2016-04-21 20:39:04", "txid": "1786e0f83777b7ca61443847094509463c9e751b92fde361129f5d6de355000e", "_id": "1786e0f83777b7ca61443847094509463c9e751b92fde361129f5d6de355000e" },
    { "destination": "me", "xmramount": 2.23, "time": "2016-04-21 20:39:04", "txid": "1a5c128a4c6e75e8489503e6c7ab459abc2a2a55338f760971ae00aef90cf4dd", "_id": "1a5c128a4c6e75e8489503e6c7ab459abc2a2a55338f760971ae00aef90cf4dd" },
    { "destination": "me", "xmramount": 9.68, "time": "2016-04-21 20:39:04", "txid": "1fb735f5601ee01af19b1fbb0bbc2fa47a59010cc980da0406ff71039f790a36", "_id": "1fb735f5601ee01af19b1fbb0bbc2fa47a59010cc980da0406ff71039f790a36" },
    { "destination": "me", "xmramount": 34.17, "time": "2016-04-21 20:39:04", "txid": "265c57b68b3447a5a8ea28b0d20ed70498154cf363f71ff7f9ca14cca1c059db", "_id": "265c57b68b3447a5a8ea28b0d20ed70498154cf363f71ff7f9ca14cca1c059db" },
    { "destination": "me", "xmramount": 6.6899999999999995, "time": "2016-04-21 20:39:04", "txid": "27e072011efe9cc8299638a9c3758f6da4435d8e543bb91430641eb40d4f9ed0", "_id": "27e072011efe9cc8299638a9c3758f6da4435d8e543bb91430641eb40d4f9ed0" },
    { "destination": "me", "xmramount": 99.19, "time": "2016-04-21 20:39:04", "txid": "2d2e34a1ac9162624e0d6073ff7ec7434ffe1ab60657214ada6419d3df01b6ac", "_id": "2d2e34a1ac9162624e0d6073ff7ec7434ffe1ab60657214ada6419d3df01b6ac" },
    { "destination": "me", "xmramount": 0.28, "time": "2016-04-21 20:39:04", "txid": "2e117bdc0bb1ce97ec55d5c7f83641aa403d14ca11e536e6fca30c6168d89166", "_id": "2e117bdc0bb1ce97ec55d5c7f83641aa403d14ca11e536e6fca30c6168d89166" },
    { "destination": "me", "xmramount": 5, "time": "2016-04-21 20:39:04", "txid": "373beb735a5797e98f6e83f1fd4e7ce880a8849bfd91bedf5299e2bc9d841461", "_id": "373beb735a5797e98f6e83f1fd4e7ce880a8849bfd91bedf5299e2bc9d841461" },
    { "destination": "me", "xmramount": 0.29000000000000004, "time": "2016-04-21 20:39:04", "txid": "39143d4c3b787c5593bede21ecb611c1b9c156f8662492a9ee9a8875e899a26b", "_id": "39143d4c3b787c5593bede21ecb611c1b9c156f8662492a9ee9a8875e899a26b" },
    { "destination": "me", "xmramount": 9.68, "time": "2016-04-21 20:39:04", "txid": "3f69319ccee7a07194be6be5f523fbf8352e8845ede11ba6747086fed81a535c", "_id": "3f69319ccee7a07194be6be5f523fbf8352e8845ede11ba6747086fed81a535c" },
    { "destination": "me", "xmramount": 8.46, "time": "2016-04-21 20:39:04", "txid": "41d3ea8dac3d243a30d5a78ad9244d5d50defaabc24c39a1b2207890382414e1", "_id": "41d3ea8dac3d243a30d5a78ad9244d5d50defaabc24c39a1b2207890382414e1" },
    { "destination": "1H5gGeZPEHbCgCs5tWUwYedQ25H3FRNcRv", "btcamount": "0.001", "xmrtouuid": "xmrto-apwhkF", "xmramount": 0.3, "xmraddr": "44TVPcCSHebEQp4LnapPkhb2pondb2Ed7GJJLc6TkKwtSyumUnQ6QzkCCkojZycH2MRfLcujCM7QR1gdnRULRraV4UpB5n4", "xmrpid": "d93b44b1fe4b160ebbd12dd01bf808e3b5702c59f0374e7816310bda76f826ba", "time": "2016-04-06 22:38:56", "txid": "44ba04f5036c42fd1e4cbca33427eb0c200ebed6c757c7a8f6d4c30df1896194", "_id": "44ba04f5036c42fd1e4cbca33427eb0c200ebed6c757c7a8f6d4c30df1896194" },
    { "destination": "me", "xmramount": 3.88, "time": "2016-04-21 20:39:04", "txid": "45c8ad528a85c2f8462817965f505cea0f61cc4f0662113ebd81797610d32d57", "_id": "45c8ad528a85c2f8462817965f505cea0f61cc4f0662113ebd81797610d32d57" },
    { "destination": "me", "xmramount": 0.14, "time": "2016-04-21 20:39:04", "txid": "4f548280ba08ddb5a0b1698e82f721bbd2f16455edf11a2676ad1eb6dbfba564", "_id": "4f548280ba08ddb5a0b1698e82f721bbd2f16455edf11a2676ad1eb6dbfba564" },
    { "destination": "me", "xmramount": 1000, "time": "2016-04-21 20:39:04", "txid": "56193b547b7701d8c3537ff37c661f6e5b66c2fcde480b3c5f974c8ec5968672", "_id": "56193b547b7701d8c3537ff37c661f6e5b66c2fcde480b3c5f974c8ec5968672" },
    { "destination": "me", "xmramount": 26.28, "time": "2016-04-21 20:39:04", "txid": "5b992a369fa7f341c4942ff0de13564cde25a9970477948deb2a63938bb02f63", "_id": "5b992a369fa7f341c4942ff0de13564cde25a9970477948deb2a63938bb02f63" },
    { "destination": "me", "xmramount": 8.69, "time": "2016-04-21 20:39:04", "txid": "6767d5a23f4ff6fa504d9cc87fc9c7749b76ce8a5ff69665b03abc515603c56b", "_id": "6767d5a23f4ff6fa504d9cc87fc9c7749b76ce8a5ff69665b03abc515603c56b" },
    { "destination": "me", "xmramount": 8.59, "time": "2016-04-21 20:39:04", "txid": "726ab2459f7f052372cd662db2a56a6a9e6599430db9f3511fd90ea9b1d7e6f3", "_id": "726ab2459f7f052372cd662db2a56a6a9e6599430db9f3511fd90ea9b1d7e6f3" },
    { "destination": "me", "xmramount": 9.38, "time": "2016-04-21 20:39:04", "txid": "76535f335c57450ad2f6ffb56bbf7dbeebbf6fcd60c7f1b2c45e0c96dc33ddf1", "_id": "76535f335c57450ad2f6ffb56bbf7dbeebbf6fcd60c7f1b2c45e0c96dc33ddf1" },
    { "destination": "me", "xmramount": 0.36, "time": "2016-04-21 20:39:04", "txid": "770e99dd1d13731ca7cca8ab8aa2716f740a58c817d712f14c4c900156e15975", "_id": "770e99dd1d13731ca7cca8ab8aa2716f740a58c817d712f14c4c900156e15975" },
    { "destination": "me", "xmramount": 8.49, "time": "2016-04-21 20:39:04", "txid": "7bfb8cd623663b36186e8087cebafd905368ae9756eae9c2b81bd53ff959b178", "_id": "7bfb8cd623663b36186e8087cebafd905368ae9756eae9c2b81bd53ff959b178" },
    { "destination": "me", "xmramount": 4.18, "time": "2016-04-21 20:39:04", "txid": "8a8fc16299e46983e2cac5ae2bc5c6911cde9b87dbd13981367fc1936c2849bf", "_id": "8a8fc16299e46983e2cac5ae2bc5c6911cde9b87dbd13981367fc1936c2849bf" },
    { "destination": "me", "xmramount": 3, "time": "2016-04-21 20:39:04", "txid": "8f3772f1ebdd892968ed7b01a4ad5df8338f6849700233206bbe2efd1f042c86", "_id": "8f3772f1ebdd892968ed7b01a4ad5df8338f6849700233206bbe2efd1f042c86" },
    { "destination": "me", "xmramount": 35.47, "time": "2016-04-21 20:39:04", "txid": "94b37ba0d7baeb9218d907017e3878ee6f4dc73f4154b8eb752d4edd7c13cd40", "_id": "94b37ba0d7baeb9218d907017e3878ee6f4dc73f4154b8eb752d4edd7c13cd40" },
    { "destination": "me", "xmramount": 19.689999999999998, "time": "2016-04-21 20:39:04", "txid": "96d72a3e0f155280ede06b30c222ca9853ce7bc60cb589c923543d2639e0b70a", "_id": "96d72a3e0f155280ede06b30c222ca9853ce7bc60cb589c923543d2639e0b70a" },
    { "destination": "169zgHoBhD9KtFkSfDev6J1bu8jZH6Ji7q", "btcamount": "0.001", "xmrtouuid": "xmrto-m9FJJx", "xmramount": 0.3, "xmraddr": "44TVPcCSHebEQp4LnapPkhb2pondb2Ed7GJJLc6TkKwtSyumUnQ6QzkCCkojZycH2MRfLcujCM7QR1gdnRULRraV4UpB5n4", "xmrpid": "eef3ce72882f79f618adf357bb38eb02fcc673fdf403d5572720149400092b40", "time": "2016-04-06 20:46:24", "txid": "dummytxnid", "_id": "9e3niwfkhbrO52DM" },
    { "destination": "1H5gGeZPEHbCgCs5tWUwYedQ25H3FRNcRv", "btcamount": "0.001", "xmrtouuid": "xmrto-hfieDy", "xmramount": 0.3, "xmraddr": "44TVPcCSHebEQp4LnapPkhb2pondb2Ed7GJJLc6TkKwtSyumUnQ6QzkCCkojZycH2MRfLcujCM7QR1gdnRULRraV4UpB5n4", "xmrpid": "b241376eff425e2d2f2b7fe01037b7b0b9d8351c4f9ef0b42768f28f21bf1bc8", "time": "2016-04-06 22:36:30", "txid": "<27e072011efe9cc8299638a9c3758f6da4435d8e543bb91430641eb40d4f9ed0>", "_id": "<27e072011efe9cc8299638a9c3758f6da4435d8e543bb91430641eb40d4f9ed0>" },
    { "destination": "1H5gGeZPEHbCgCs5tWUwYedQ25H3FRNcRv", "btcamount": "0.001", "xmrtouuid": "xmrto-mrJmDP", "xmramount": 0.3, "xmraddr": "44TVPcCSHebEQp4LnapPkhb2pondb2Ed7GJJLc6TkKwtSyumUnQ6QzkCCkojZycH2MRfLcujCM7QR1gdnRULRraV4UpB5n4", "xmrpid": "4093a8cc572fa5c26bc3630d26e47082437b524d8649acfb53c6a4824817bcf7", "time": "2016-04-06 22:31:40", "txid": "dummytxnid", "_id": "ECXZgDBY5SHbq8t1" },
    { "destination": "1AZ422kBEbam17CNU3j3kvgwFwTQCaULdz", "btcamount": "0.001", "xmrtouuid": "xmrto-uR5njT", "xmramount": 0.3, "xmraddr": "44TVPcCSHebEQp4LnapPkhb2pondb2Ed7GJJLc6TkKwtSyumUnQ6QzkCCkojZycH2MRfLcujCM7QR1gdnRULRraV4UpB5n4", "xmrpid": "fdf8a927935494018edd46442c4eff0502b2ce2a8e33ff6e19d8be03c9bda066", "time": "2016-04-06 21:38:07", "txid": "[object Object]", "_id": "[object Object]" },
    { "destination": "me", "xmramount": 0.69, "time": "2016-04-21 20:39:04", "txid": "a9d246b1cb102fff210aad272b04a27db94f4df08b833931eac6ae56d69e7618", "_id": "a9d246b1cb102fff210aad272b04a27db94f4df08b833931eac6ae56d69e7618" },
    { "destination": "me", "xmramount": 4.74, "time": "2016-04-21 20:39:04", "txid": "b524d3dde1307eaab729338470327e74559ff9193e95aab9a4ab5f3a9cbf482e", "_id": "b524d3dde1307eaab729338470327e74559ff9193e95aab9a4ab5f3a9cbf482e" },
    { "destination": "me", "xmramount": 0.07, "time": "2016-04-21 20:39:04", "txid": "c07bfd4270557d98634a7152823280e121032183aeb92ae64c5cdf21a728d4f9", "_id": "c07bfd4270557d98634a7152823280e121032183aeb92ae64c5cdf21a728d4f9" },
    { "destination": "me", "xmramount": 149.16, "time": "2016-04-21 20:39:04", "txid": "c933546fb6f80b6120c683c4c1c9493871f48a8b6b3697c6be06c9ced38226e2", "_id": "c933546fb6f80b6120c683c4c1c9493871f48a8b6b3697c6be06c9ced38226e2" },
    { "destination": "me", "xmramount": 89.49, "time": "2016-04-21 20:39:04", "txid": "d950c789524f3c0b4e854aa0f45cf579f74858f8c62117df5a544529621e7554", "_id": "d950c789524f3c0b4e854aa0f45cf579f74858f8c62117df5a544529621e7554" },
    { "destination": "me", "xmramount": 5, "time": "2016-04-21 20:39:04", "txid": "dc0ffc63f544c257a4a18e90dcc1d6bb476b2c0cf52047ceb62ee2fbeb4e2fe1", "_id": "dc0ffc63f544c257a4a18e90dcc1d6bb476b2c0cf52047ceb62ee2fbeb4e2fe1" },
    { "destination": "me", "xmramount": 0.19, "time": "2016-04-21 20:39:04", "txid": "e5514276325ba8a9110d4807a6e2854f92b604280d8e29b6dae60069f5fe3334", "_id": "e5514276325ba8a9110d4807a6e2854f92b604280d8e29b6dae60069f5fe3334" },
    { "destination": "me", "xmramount": 293.09000000000003, "time": "2016-04-21 20:39:04", "txid": "e862944ad82371480d2dff384160e0ff33ccaec7dd67697aead814156969a233", "_id": "e862944ad82371480d2dff384160e0ff33ccaec7dd67697aead814156969a233" },
    { "destination": "me", "xmramount": 19.619999999999997, "time": "2016-04-21 20:39:04", "txid": "ea8f9344df2541a84a76bdf1ead60706a5357af8b6506ea7e8c398b42af0e745", "_id": "ea8f9344df2541a84a76bdf1ead60706a5357af8b6506ea7e8c398b42af0e745" },
    { "destination": "me", "xmramount": 139.7, "time": "2016-04-21 20:39:04", "txid": "ecadaccb9979edd7ca7e82d20c266aa2b10edadaf507dcc744c10941b4d5b726", "_id": "ecadaccb9979edd7ca7e82d20c266aa2b10edadaf507dcc744c10941b4d5b726" },
    { "destination": "me", "xmramount": 7.68, "time": "2016-04-21 20:39:04", "txid": "f0d82fa8a5cceb5b73993fb455a8281991e248bed9055b98b202e0ed7e2a3268", "_id": "f0d82fa8a5cceb5b73993fb455a8281991e248bed9055b98b202e0ed7e2a3268" },
    { "destination": "me", "xmramount": 0.29000000000000004, "time": "2016-04-21 20:39:04", "txid": "fb2d3ac338c485a96c28d3dc0210d24e6a7561459429a6f891f0543e6b841e20", "_id": "fb2d3ac338c485a96c28d3dc0210d24e6a7561459429a6f891f0543e6b841e20" },
    { "destination": "me", "xmramount": 0.18, "time": "2016-04-21 20:39:04", "txid": "fb527e1a1b86caa6debaacd97dbcae62f9ff47e3f919e773f547e6a4993867e7", "_id": "fb527e1a1b86caa6debaacd97dbcae62f9ff47e3f919e773f547e6a4993867e7" },
    { "destination": "1H5gGeZPEHbCgCs5tWUwYedQ25H3FRNcRv", "btcamount": "0.001", "xmrtouuid": "xmrto-3sjXfh", "xmramount": 0.3, "xmraddr": "44TVPcCSHebEQp4LnapPkhb2pondb2Ed7GJJLc6TkKwtSyumUnQ6QzkCCkojZycH2MRfLcujCM7QR1gdnRULRraV4UpB5n4", "xmrpid": "15cf9ba32c5169b03bb2250051a2dd7ee94ec66c9410035e8f8c59e0352600ba", "time": "2016-04-06 22:32:52", "txid": "tx_hash", "_id": "tx_hash" },
    { "destination": "1H5gGeZPEHbCgCs5tWUwYedQ25H3FRNcRv", "btcamount": "0.001", "xmrtouuid": "xmrto-YXhBFT", "xmramount": 0.3, "xmraddr": "44TVPcCSHebEQp4LnapPkhb2pondb2Ed7GJJLc6TkKwtSyumUnQ6QzkCCkojZycH2MRfLcujCM7QR1gdnRULRraV4UpB5n4", "xmrpid": "dfc2ac8d9f473e2233c5b8883550a8219ff7115919299845681107bea738a70a", "time": "2016-04-06 22:33:58", "txid": "tx_key", "_id": "tx_key" },
    { "destination": "1H5gGeZPEHbCgCs5tWUwYedQ25H3FRNcRv", "btcamount": "0.001", "xmrtouuid": "xmrto-JTGkHp", "xmramount": 0.3, "xmraddr": "44TVPcCSHebEQp4LnapPkhb2pondb2Ed7GJJLc6TkKwtSyumUnQ6QzkCCkojZycH2MRfLcujCM7QR1gdnRULRraV4UpB5n4", "xmrpid": "0cb02adedfefbd197c3263be453f89e383b5782c32799c64dcc6c2086149b034", "time": "2016-04-06 22:35:31", "txid": "undefined", "_id": "undefined" }];


var Txn = React.createClass({

    render: function () {
        var address;
        if (this.props.destination == 'none') {
            address = this.props.xmraddr;
        } else {
            address = this.props.destination;
        }

        var classes = 'email-item pure-g';
        var content = "To: "+address;
        if (this.props.selected) {
            classes += ' email-item-selected';
            return (
                <div className={classes} onClick={this.props.on_click.bind(null) }>
                    <div className="pure-u" onClick={this.props.on_click.bind(null) }>
                        <h5 className="email-name">{this.props.time}</h5>
                        <h4 className="email-subject">{this.props.xmramount} XMR</h4>
                        <p className="email-desc">
                            <ul>
                                <li>DEST: {this.props.tx.destination}</li>
                                <li>XMR.TO: {this.props.tx.xmrtouuid}</li>
                                <li>HASH: {this.props.tx.txid}</li>
                            </ul>
                        </p>
                    </div>
                </div>
            );
        } else {
            return (
                <div className={classes} onClick={this.props.on_click.bind(null) }>
                    <div className="pure-u" onClick={this.props.on_click.bind(null) }>
                        <h5 className="email-name">{this.props.time}</h5>
                        <h4 className="email-subject">{this.props.xmramount} XMR</h4>
                        <p className="email-desc">
                            Destination: {address}
                        </p>
                    </div>
                </div>
            );
        }
    }
});

//Basically, I want a smooth e-mailish Txn List
//You click on the txn, and it opens more details
var TxnList = React.createClass({

    render: function () {

        var items = this.props.txns.map(function (txn, i) {
            return (
                <Txn
                    key={txn._id}
                    onClick={this.props.onTxnSelected.bind(null, i) }
                    on_click={this.props.onTxnSelected.bind(null, i) }
                    selected={this.props.selected === i}
                    time={txn.time}
                    tx={txn}
                    xmramount={txn.xmramount}
                    destination={txn.destination}
                    xmraddr={txn.xmraddr}
                    >
                    "tx"
                </Txn>
            );
        }, this);

        return (
            <div id="list" className="pure-u-1">
                {items}
            </div>
        );
    }
});

var App = React.createClass({
    getInitialState: function () {
        return { selected: 1 };
    },
    handleTxnSelected: function (index) {
        this.setState({ selected: index });
    },
    render: function () {
        return (
            //<div id="layout" className="content pure-g">
            <div className="pure-g-r id-layout">

                <TxnList txns={this.props.txns} selected={this.state.selected} onTxnSelected={this.handleTxnSelected} />

            </div>
        );
    }
});


document.getElementById("txnlink").onclick = writeTxns;

function writeTxns() {
    var theUrl = 'https://localhost:3000/api/localtransactions/';

    $.ajax({
        url: theUrl,
        type: 'GET',
        success: function (data) {
            document.getElementById("qrcode").innerHTML = '';
            document.getElementById('innercontent').innerHTML = '';
            ReactDOM.render(
                <App txns={JSON.parse(data) } />,
                document.getElementById('innercontent')
            )},
        error: function (data) {
            alert('error contacting simplewallet, displaying sample data!'); //or whatever
            document.getElementById("qrcode").innerHTML = '';
            document.getElementById('innercontent').innerHTML = '';
            ReactDOM.render(
                <App txns={sampleData} />,
                document.getElementById('innercontent')
            )}
    });
}